
@{
    ViewBag.Title = "Servicio";
}

<div class="loader"></div> <!--REVISAR SI ES UTLIZADO-->


<!--==============================================================================
                               MODAL LISTAR TIPOS
==================================================================================-->
<div class="modal" id="myModal">
	<div class="modal-dialog modal-lg">
      <div class="modal-content" style="padding: 50px">
        <div class="x_title">
              <h2>Tipos</h2>
              <ul class="nav navbar-right panel_toolbox">
                  <li>
                      <input type="button" data-toggle="modal" href="#myModal2" class="btn btn-primary" id="btn-nuevo-tipo-grupo" value="NUEVO">
                  </li>
                  <li>
                      <input type="button" onclick="triguer_menu_principal()" href="#" data-dismiss="modal" class="btn btn-dark" value="CERRAR">
                  </li>                 
              </ul>
              <div class="clearfix"></div>
          </div>
        <div class="modal-body">

            <!-- TABLA TIPO GRUPO (dentro del modal) -->
            <table id="DataTableTipoGrupo" class="table table-striped table-bordered table-responsive nowrap" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th style="display:none">IntIdTipo</th>
                        <th>Código</th>
                        <th>Descripción</th>
                        <th style="display:none">strAbreviatura</th>
                        <th>SubGrupo</th>
                        <th style="display:none">strSubGrupo</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        
        </div>
      </div>
    </div>
</div>

<input type="button" id="Asistencia_Servicio" onclick="location.href='/Asistencia/Servicio?intIdMenu=32';" value="Refrescar Mantenimiento Servicio "  hidden/>

<!--==============================================================================
                  MODAL PARA NUEVO y EDITAR (en un solo modal)
==================================================================================-->
<div class="modal" id="myModal_ne" data-backdrop="static">
    <div class="modal-dialog" style="height:620px; top: 30px;">
        <div class="modal-content" style="height:80%; top: 30px; width: 70%; padding: 50px">

            <label id="lblIntIdTipo" hidden></label>

            <!-- EDITAR -->
            <div class="x_title" id="x_title_editar" hidden>
                <h2>Editar Tipo</h2>
                <div class="clearfix"></div>
            </div>

            <!-- NUEVO -->
            <div class="x_title" id="x_title_nuevo" hidden>
                <h2>Nuevo Tipo</h2>
                <div class="clearfix"></div>

            </div>

            <div class="modal-body"><br />                

                <!--COMBO SUBGRUPO -->
                <div class="col-md-12 col-sm-6 col-xs-12">
                    <div class="form-group"  >
                        <label>SubGrupo (*)</label>
                        <select class="form-control" id="cboSubGrupoTipo_ne"><!-- SE CARGA UNA SOLA VEZ -->
                            <option value="0">Seleccione</option>
                        </select>
                    </div>
                </div>

                <!-- INPUT DESCRIPCION-->
                <div class="col-md-12 col-sm-6 col-xs-12">
                    <div class="form-group" id="strDeTipo">
                        <label>Descripción (*)</label>
                        <input type="text" id="txtDescripcion_ne" placeholder="Descripción"  class="form-control" _vkenabled="true" _originaltype="text">
                    </div>
                </div>

                <!-- INPUT ABREVIATURA -->
                <div class="col-md-12 col-sm-6 col-xs-12">
                    <div class="form-group" id="strAbreviatura">
                        <label class="control-label">Abreviatura (*)</label>
                        <input type="text" id="txtAbreviatura_ne" placeholder="Abreviatura" class="form-control" _vkenabled="true" _originaltype="text">
                      
                    </div>
                    <input type="text" id="txtDescripcion_ne_e" placeholder="Descripción" class="form-control" _vkenabled="true" _originaltype="text" hidden>
                </div>


                @*<!-- INPUT DESCRIPCION - SIN VALIDAR -->
                <div class="col-md-12 col-sm-6 col-xs-12">
                    <div class="form-group" id="ValDesc">
                        <label>Descripción (*)</label>
                        <input type="text" id="txtDescripcion_ne" placeholder="Descripción" class="form-control" _vkenabled="true" _originaltype="text">
                    </div>
                </div>

                <!-- INPUT ABREVIATURA  - SIN VALIDAR -->
                <div class="col-md-12 col-sm-6 col-xs-12">
                    <div class="form-group" id="ValAbrev">
                        <label class="control-label">Abreviatura (*)</label>
                        <input type="text" id="txtAbreviatura_ne" placeholder="Abreviatura" class="form-control" _vkenabled="true" _originaltype="text">
                    </div>
                </div>*@

                <!-- BOTON ACTUALIZAR -->
                <div class="col-md-12 col-sm-6 col-xs-12 btn-actualizar" hidden>
                    <br />
                    <div class="form-group">
                        <a href="#" class="btn btn-success form-control" id="btn-actualizar-tipo-grupo">ACTUALIZAR</a>
                    </div>
                    <br />

                    <div class="form-group">
                        <a href="#" data-dismiss="modal" class="btn btn-dark form-control">CANCELAR</a>
                    </div>
                    <br />

                </div>

                <!-- BOTON GUARDAR -->
                <div class="col-md-12 col-sm-6 col-xs-12 btn-nuevo" hidden>
                    <br />
                    <div class="form-group">
                        <a href="#" class="btn btn-primary form-control" id="btn-guardar-tipo-grupo">GUARDAR</a>
                    </div>

                    <br />
                    <div class="form-group">
                        <a href="#" data-dismiss="modal"  class="btn btn-dark form-control" >CANCELAR</a>  
                    </div>
                    <br />
                </div>

            </div>

        </div>
    </div>
</div>

<!--==============================================================================
                         ESTILOS MODAL - TIPO GRUPO 
==================================================================================-->
<style>
  
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1100; /* Sit on top */
        padding-top: 40px; /* Location of the box */ /**************************TOP DEL MODAL DEL LISTADO*/ 
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
        background-color: #fefefe;
        margin: auto;
        /*padding: 50px;*/
        border: 1px solid #888;
        /*width: 70%;
        height: 80%;*/
    }

    /* The Close Button */
    .close {
        color: #aaaaaa;
        float: right;
        /*font-size: 28px;*/
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
</style>

<div class="row">
    <!--INICIO PANEL-->
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">

            <!--Inicio de código para solucionar observación 17.2  HG 24.02.2021-->
            <div class="col-lg-4 col-md-5 col-sm-5 col-xs-12">
                <label class="" style="text-align: right !important;">Buscar </label>
                <input type="text" id="filtro" class="form-control" placeholder="Buscar por Código y Descripción">
            </div>

            <!--AÑADIDO 18.03.2021-->
            <div class="col-lg-2 col-md-3 col-sm-3 col-xs-12">
                <label class="control-label" style="text-align: right !important;">Clase de Servicio</label>
                <select class="form-control" id="ClaseServFiltro">
                    <option value="0" selected>Seleccione</option>
                </select>
            </div>

            <!--AÑADIDO-->
            <div class="col-lg-2 col-md-3 col-sm-3 col-xs-12">
                <label class="control-label" style="text-align: right !important;">Tipo de Servicio</label>
                <select class="form-control" id="TipServicio">
                    <option value="0" selected>Seleccione</option>
                </select>
            </div>

            <!--AÑADIDO-->
            <div class="col-lg-2 col-md-3 col-sm-3 col-xs-12">
                <label class="control-label" style="text-align: right !important;">Tipo de Menú</label>
                <select class="form-control" id="TipMenu">
                    <option value="0" selected>Seleccione</option>
                </select>
            </div>

            <!--AÑADIDO-->
            <div class="col-lg-2 col-md-3 col-sm-3 col-xs-12">
                <label class="control-label" style="text-align: right !important;">Estado</label>
                <select class="form-control" id="filActi">
                    <option value="2">Todos</option>
                    <option value="1" selected>Activo</option>
                    <option value="0">Inactivo</option>
                </select>
            </div>
            <!--Fin de código para solucionar observación 17.2  HG 24.02.2021-->

        </div>
    </div>
</div>

<!-- PANEL DE MENUS -->
<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="breadcrumb">
            <a class="breadcrumb__step breadcrumb__step--active" href="#">Comedor</a>
            <a class="breadcrumb__step" style="width: 90%;" href="#">Servicio</a>
        </div>
    </div>
</div>

<div class="row">
    <!-- PANEL TABLA -->
    <div class="col-lg-7 col-md-7 col-sm-12 col-xs-12">
        <div class="x_panel">
            <div class="x_title">
                <h2>Listado de Servicios</h2>  
                <ul class="nav navbar-right panel_toolbox">
                    <li>
                        <input type="button" id="tabla-listar-tipo-grupo-icono" class="btn btn-info" value="Mant. Tipos" @*data-toggle="modal"*@ @*href="#myModal"*@>
                        @*<h4 style="padding-right:10px;" id="tabla-listar-tipo-grupo-icono" type="button" data-toggle="modal" href="#myModal"><i class="fa fa-share" aria-hidden="true"></i> <span style="color: #657a90;font-family: Calibri; font-weight: bold;">TIPOS</span></h4>*@
                    </li>  
                    <li>
                        <input type="button" id="btn-new-servicio" class="btn btn-primary " value="Nuevo Servicio">
                    </li>
                </ul>
                <div class="clearfix"></div>
            </div>
            <div class="x_content" id="">

                <table id="tablaservicio" class="table table-striped table-bordered table-responsive pre-wrap" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Descripción</th>
                            <th>Clase</th><!--añadido 18.03.2021-->
                            <th>Tipo Servicio</th>
                            <th>Tipo Menú</th>
                            <th>Estado</th>
                            <th>Acción</th>
                            <th style="display:none">bitFlActivo</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>


            </div>
        </div>
    </div>



    <!-- SEGUNDO PANEL -->
    <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">
        <div class="form-hide-servicio" hidden>
            <!-- INICIO Loader -->
            <!-- Desde el documento Custom.css estan sus estilos -->
           
            <div id="hg_loader_espera" hidden>
                <div id="hg_div_detras_de_loader"></div>
                <div class="blobs">
                    <div class="blob-center"></div>
                    <div class="blob"></div>
                    <div class="blob"></div>
                    <div class="blob"></div><!--añadido 18.03.2021-->
                    <div class="blob"></div>
                    <div class="blob"></div>
                    <div class="blob"></div>
                    <div class="blob"></div>

                    <div class="loading-container">
                        <!-- <div class="loading"></div>   Color verde: #23af94 Azul oscuro: #8392b5 #2A3F54 -->
                        <div style="color: #8392b5 ; text-shadow: 0 0 0.5px #2A3F54;  letter-spacing: 3px;" id="loading-text">Cargando</div>
                    </div>

                </div>

                <svg version="1.1">
                    <defs>
                        <filter id="goo">
                            <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
                            <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />
                            <feBlend in="SourceGraphic" in2="goo" />
                        </filter>
                    </defs>
                </svg>
                
            </div><!-- FIN del Loader  -->

            <div class="x_panel"  >
                <div class="x_title" >
                    <h2>Información del Servicio</h2>
                    <ul class="nav navbar-right panel_toolbox" >
                        <li>
                            <input type="button" id="btn-save-change-servicio"  class="btn btn-primary" value="Guardar">
                            <input type="button" id="btn-update-servicio"  class="btn btn-success" value="Actualizar" hidden>
                        </li>
                        <li>
                            <input type="button" id="btn-cancel-servicio"  class="btn btn-dark" value="Cancelar">
                        </li>

                    </ul>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">
                    <form class="form-horizontal form-label-left">
                        <div class="row">
                            <div class="col-md-6 col-sm-6 col-xs-6">
                            </div>
                            <div style="text-align:right;" id="11">
                            </div>
                        </div>

                        <div class="row">
                            <div class="border-section">
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group" id="strCoServicio">
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group" id="strDesServicio">
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group">
                                        <label>Clase de Servicio (*)</label>
                                        <select class="form-control" id="ClaseServ"></select>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div class="form-group" id="strCoExporta">
                                    </div>
                                </div>
                                <!-- ESTA PARTE de Dependencia Jerárquica (*) NO LO PIDE LAIVE -->
                                <div class="col-md-6 col-sm-6 col-xs-6" hidden>
                                    <div class="form-group">
                                        <!-- Por ello se ha desabilitado -->
                                        <label>Dependencia Jerárquica (*)</label>
                                        <select class="form-control" id="JerOrG" disabled></select>
                                    </div>
                                </div>

                                <!-- ESTA PARTE de Dependencia Jerárquica TAMPOCO LO PIDE LAIVE -->
                                <div class="col-md-6 col-sm-6 col-xs-6" hidden>
                                    <div class="form-group">
                                        <div>
                                            <label class="col-md-7 col-sm-7 col-xs-6"> Und. Organizacional </label>
                                        </div>
                                        <!-- Por ello tambien se ha desabilitado -->
                                        <select class="form-control" id="UndOrG" disabled></select>
                                    </div>
                                </div>

                                <div class="col-md-6 col-sm-6 col-xs-6" id="DivTipServicios">
                                    <div class="form-group">
                                        <label>Tipo de Servicio (*)</label>
                                        <select class="form-control" id="TipServicios"></select>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6" id="DivTipMenus">
                                    <div class="form-group">
                                        <label>Tipo de Menú (*)</label>
                                        <select class="form-control" id="TipMenus"></select>
                                    </div>
                                </div>
                                <br />
                                <div id="DivCamposAdicionalesServicio">
                                    <!--==== CONTENEDOR DE CAMPOS ADICIONALES ====-->
                                </div>
                                <br />

                                <div class="col-md-6 col-sm-6 col-xs-6" style="left:2%">
                                    <br />
                                    <input type="checkbox" class="flat" id="ConCosto" />  CON COSTO
                                </div>
                                <br />
                                <div class="col-md-6 col-sm-6 col-xs-6" id="DivCategSC">
                                    <div class="form-group">
                                        <label>Categoría del Complemento (*)</label>
                                        <select class="form-control" id="CategSC"></select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <br />
                        <br />


                        <div class="row">
                            <div class="border-section" id="div-contenedor-con-costo">
                                <!--Modificación(se añadió) de código para solucionar Observación 15.4  HG 24.02.2021-->

                                <div class="col-md-6 col-sm-6 col-xs-6" id="Money">
                                    <div class="form-group">
                                        <label>Moneda (*)</label>
                                        <select class="form-control" id="Moneda">
                                            <!-- COMBOBOX Moneda (*) DESDE EL JS -->
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-6 col-sm-6 col-xs-6" id="TipMoney">
                                    <div class="form-group">
                                        <div id="strMontoCosto">
                                            <!-- INPUT Monto del Costo DESDE EL JS -->
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>


                        <input type="hidden" id="IntIdServicio" />
                        <br />

                    </form>
                </div>
            </div>

        </div>
    </div>

</div>

<script>
    $(document).ready(function () {
        CombosServicios();
        TablaServicios(); 
        //switcheryLoad();
    });
    //
    function filterFloat(evt, input) {
        // Backspace = 8, Enter = 13, ‘0′ = 48, ‘9′ = 57, ‘.’ = 46, ‘-’ = 43
        var key = window.Event ? evt.which : evt.keyCode;
        var chark = String.fromCharCode(key);
        var tempValue = input.value + chark;

        var index = tempValue.indexOf(".")

        if (index == -1) {//sin punto
            if (key >= 48 && key <= 57) {
                if (filterE(tempValue) === false) {
                    return false;
                } else {
                    return true;
                }
            } else {
                if (key == 8 || key == 13 || key == 0) {
                    return true;
                } else if (key == 46) {
                    if (filterE(tempValue) === false) {
                        return false;
                    } else {
                        return true;
                    }
                } else {
                    return false;
                }
            }
        } else {//con  punto
            if (key >= 48 && key <= 57) {
                if (filter(tempValue) === false) {
                    return false;
                } else {
                    return true;
                }
            } else {
                if (key == 8 || key == 13 || key == 0) {
                    return true;
                } else if (key == 46) {
                    if (filter(tempValue) === false) {
                        return false;
                    } else {
                        return true;
                    }
                } else {
                    return false;
                }
            }
        }


    }
    function filter(__val__) {
        var preg = /^([0-9]{1,4}\.?[0-9]{0,2})$/;
        
            if (preg.test(__val__) === true) {
                return true;
            } else {
                return false;
            }
    }
    function filterE(__val__) {
        var pregE = /^([0-9]{1,4})$/;

            if (pregE.test(__val__) === true) {
                return true;
            } else {
                return false;
            }
    }
    //
    //Solo numeros
    //onkeyup="caracteres_solo_numeros(this.value)"
    function caracteres_solo_numeros(string) {
        var out = '';
        var filtro = '1234567890,.';
        for (var i = 0; i < string.length; i++)
            if (filtro.indexOf(string.charAt(i)) != -1)
                out += string.charAt(i);
        return out;
    }  

    function avoidSpaceInput(event) {
        let k = event ? event.which : window.event.keyCode;
        if (k == 32) return false;

    }

    //PARA NO PERMITIR ESPACIOS EN BLACO miercoles24
    $('#txtMontoCosto').keypress(function (e) {
        if (e.which === 32)
            return false;
    });


    //Inicio de código para solucionar observación 15.5   HG 24.02.2021
    function validarCampoCosto(evt) {

        var theEvent = evt || window.event;

        // Handle paste
        if (theEvent.type === 'paste') {
            key = event.clipboardData.getData('text/plain');
        } else {
            // Handle key press
            var key = theEvent.keyCode || theEvent.which;
            key = String.fromCharCode(key);
        }
        var regex = /[0-9]|\./; 
        if (!regex.test(key)) {
            theEvent.returnValue = false;
            if (theEvent.preventDefault) theEvent.preventDefault();
        }

    }

    /*
       La función "validarCampoCosto" usada como onkeypress="validarCampoCosto(event)"
       dentro del input id="strMontoCosto" permitirá:

       . bloquear la barra espaciadora
       . permitir solamente digitos y un punto
       . restringir letras
       . restringir caracteres especiales

       FUENTE: https://stackoverflow.com/questions/469357/html-text-input-allow-only-numeric-input

    */
    //Fin de código para solucionar observación 15.5   HG 24.02.2021


    //function ListarCaracteresMax(){

    //PARA EL FORMULARIO NUEVO Y EDITAR TIPO
    $.post(
        '/Organizacion/ListarCaracteresMax',//'/Proceso/MaestroMaxCaracteres',
        { strMaestro: 'TGTIPO' },
        (response) => {

            response.forEach(element => {

                if (element.strColumnName == 'strDeTipo') {

                    $('#' + element.strColumnName + '').empty();
                    $('#' + element.strColumnName + '').append('<label>Descripción (*)</label><input type = "text" class= "form-control" id = "txtDescripcion_ne" placeholder = "Código" maxlength="' + element.intMaxLength + '" onkeypress="validarDescripcionAll(event)" ><div id="notifry_error1" style="background-color:#4CA4DE;color:white;text-align:center;"></div>');
                }

                else if (element.strColumnName == 'strAbreviatura') {
                    $('#' + element.strColumnName + '').empty();
                    $('#' + element.strColumnName + '').append('<label>Abreviatura (*)</label><input type = "text" class= "form-control" id = "txtAbreviatura_ne" placeholder = "Descripción" maxlength="' + element.intMaxLength + '" onkeypress="validarCodigoAll(event)" ><div id="notifry_info_abreviatura" style="background-color:#4CA4DE;color:white;text-align:center;"></div>');
                }

                $("#txtDescripcion_ne").keyup(function () {

                    $('#notifry_error1').html('');
                        document.getElementById("txtDescripcion_ne").style.borderColor = "#CCCCCC";
                });

                $("#txtAbreviatura_ne").keyup(function () {
                    $('#notifry_info_abreviatura').html('');
                        document.getElementById("txtAbreviatura_ne").style.borderColor = "#CCCCCC";
                    });

                //}

            });

            //////////////////////
            //////////////////////

        });


    //}

    //ListarCaracteresMax();

    //PARA EL FORMULARIO NUEVO Y EDITAR SERVICIO
    $.post(
    '/Organizacion/ListarCaracteresMax',//'/Proceso/MaestroMaxCaracteres',
    { strMaestro: 'TCSERVICIO' },
    (response) => {
        response.forEach(element => {
            if (element.strColumnName == 'strCoServicio') {
                $('#' + element.strColumnName + '').empty();
                $('#' + element.strColumnName + '').append('<label>Código (*)</label><input type = "text" class= "form-control" id = "txtCoServicio" placeholder = "Código" maxlength="' + element.intMaxLength + '"  onkeypress="validarCodigoAll(event)"><div id="notifry_error" style="background-color:#4CA4DE;color:white;text-align:center;"></div>');
            } else if (element.strColumnName == 'strDesServicio') {
                $('#' + element.strColumnName + '').empty();

                $('#' + element.strColumnName + '').append('<label>Descripción (*)</label><input type = "text" class= "form-control" id = "txtDescServicio" placeholder = "Descripción" maxlength="' + element.intMaxLength + '"  onkeypress="validarDescripcionAll(event)"><div id="notifry_errordes" style="background-color:#4CA4DE;color:white;text-align:center;"></div>');
            } else if (element.strColumnName == 'strCoExporta') {
                $('#' + element.strColumnName + '').empty();

                $('#' + element.strColumnName + '').append('<label>Código Externo </label><input type = "text" class= "form-control" id = "txtCoExterno" placeholder = "Codigo Externo" maxlength="' + element.intMaxLength + '" onkeypress="validarCodigoAll(event)" ><div id="notifry_errorexp" style="background-color:#4CA4DE;color:white;text-align:center;"></div>');

                $("#txtCoServicio").keyup(function () {
                    $('#notifry_error').html('');
                    document.getElementById("txtCoServicio").style.borderColor = "#CCCCCC";
                });
                $("#txtDescServicio").keyup(function () {
                    $('#notifry_errordes').html('');
                    document.getElementById("txtDescServicio").style.borderColor = "#CCCCCC";
                });

            }

        });

    });





 
</script>


<script src="~/Scripts/jquery-ui.min.js"></script>
