@{
    ViewBag.Title = "Toma de Consumo";
}

@*<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>*@
<!-- NOTA: FALTA DIAGRAMAR BIEN LOS CONTENEDORES PARA QUE SEA RESPONSIVE EN TODA ESTA VISTA -->

<script src="~/Scripts/jquery/tc_jquery-3.5.1.js"></script>
<script src="~/Scripts/jquery/tc_jquery.dataTables.min.js"></script>
<script src="~/Scripts/jquery/tc_jquery.min.js"></script>



<script type="text/javascript">
    $(window).load(function () {
        $(".loader").fadeOut("slow");
        $('#contenedor_padre_datos_comensal').hide();
        //$('#lblIdAsistencia').empty();//comentado el 14.04.2021 HG
        $('#table-lista-servicios-disponibles').hide();
        //$SIDEBAR_MENU.find('li.active ul').hide();//comentado 06.05.2021
        //$SIDEBAR_MENU.find('li.active').addClass('active-sm').removeClass('active');//comentado 06.05.2021
        //$('.nav-md nav-sm').hide();//comentado 06.05.2021
        //$('.nav-sm').hide;//comentado 06.05.2021
        //$('.nav-md').hide;//comentado 06.05.2021
        $('#contenedor_render_body').removeClass('right_col');
        $('#profile_clearfix').hide();
        //$("#contenedor_lateral_izquierdo").hide();////comentado 06.05.2021
        $("#contenedor_superior_top_nav").show();
        barra_cerrar_sesion();
        //$('.toggle').hide();//comentado 06.05.2021
        modalIngreseMarcador();
        traerComboMarcadorDeTipoDni();//Traer Solo el Marcador de Tipo DNI mediante método de combo

        maxCarateresDocIdentidad();

    });

    function barra_cerrar_sesion() {
        $(".top_nav").show();
        $('#ul_nav_navbar-nav_navbar-right').width('150%');
        $('#ul_nav_navbar-nav_navbar-right').css('background-color', '#f7f7f7');
        $('#table-lista-servicios-disponibles').hide();
        $('#idTemporizador').hide();
        $('#contenedor_superior_top_nav').css('background-color', 'transparent');
        //$("#btnContra").hide();
    }


</script>

<!-- IMPORTANTE!! No visible pero necesario para el tiempo de espera-->
<label style="font-size:40px; color:transparent;" id="tiempo_cierre_consumo_web_config" hidden>
    @Session["TiempoCierreConsumo"]
</label>

<!-- IMPORTANTE!! No visible pero necesario para el tiempo de espera-->
<label style="font-size:40px; color:transparent;" id="tiempo_cierre_consumo_after" hidden>
    @Session["TiempoCierreConsumoAfter"]
</label>

<!--Para ser llenado desde el Websocket M12_20.12.2020_Domingo // Comentado 14.04.2021 HG-->
@*<h1 style="font-size:100px;color:transparent;" id="lblIdAsistencia" hidden></h1>*@
<input type="text" id="input_idAsistencia"
       style="font-size:7px;
       border:none; color: transparent;
       background-color:transparent;
       "
       value="0">

<div id="contenedor_superior_top_nav2" style="z-index:1000"></div>
<!--==============================================================================
                                 MODAL INGRESE MARCADOR
==================================================================================-->
<!--==============================================================================
                              MODAL COMBO MARCADOR
==================================================================================-->
<!-- Trigger/Open The Modal -->
<button id="myBtn" hidden>Open Modal</button>
<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content" style="z-index:1100; width: 30%; ">
        <span class="close">&times;</span>
        <p>Seleccione el Marcador</p>

        <div @*class="col-md-6 col-sm-6 col-xs-12"*@>
            <div class="form-group">
                <label>Empresa (*)</label>
                <select class="form-control" id="cboEmpresa">
                    <option value="0">Seleccione</option>
                </select>
            </div>
        </div>

        <div @*class="col-md-6 col-sm-6 col-xs-12"*@>
            <div class="form-group">
                <label>Local (*)</label>
                <select class="form-control" id="cboLocal">
                    <option value="">Seleccione una Empresa</option>
                </select>
            </div>
        </div>

        <div @*class="col-md-6 col-sm-6 col-xs-12"*@>
            <div class="divMarcador">
                <label class="control-label">Marcador</label>
                <select class="form-control" id="cboMarcador">
                    <option value="0" selected>Seleccione un Local</option>
                </select>
            </div>
        </div>


        <br />

        <center>
            <button id="abrir_ventana_modo_espera" type="submit" class="btn btn-primary btn-block">CONTINUAR</button>

            <br /><br />
            <label id="seleccioneUnMarcador" style="color:#F50707;"></label>
        </center>

    </div>

</div>

<!--==============================================================================
               CONTENEDOR DE PANTALLA/VISOR EN MODO DE ESPERA
==================================================================================-->
<div id="pantalla_bienvenida_modo_espera" style="background-color:#f5f5f5; z-index:1000; height:100%; margin:0px 0 0 0px; width:100%;  display:block;" hidden>
    <div>
        <br /> <br /> <br /> <br /> <br /> <br />
        <center>
              <h1 style="font-size:60px;">
                  REGISTRE SU MARCA
                  <br /> EN EL RELOJ N°
                  <label id="numeroMarcadorDelVisor"></label>
                  <br />
                  <button id="btn-update-marcadorToma" class="btn btn-info btn-xs" style="width:150px; margin:10px 0 0 35px; font-size:17px; "> CAMBIAR RELOJ  <i class="fa fa-refresh"></i></button><br />
              </h1>
              <input type="button" id="boton_trigger_visor" value="Visor" hidden>

              <br />
              <div class="innerdiv">
                   <div class="copiar_texto">
                         <label style="font-size:35px;" id="time"></label>
                   </div>
               </div>
              <br />
                                               <!-- INGRESAR DNI -->
              <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6" style="left:38%;">

                                                   <label style="font-size:16px;">Si no puede marcar en el reloj, Marque con su DNI</label><br />

                                                   <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6" style="display:flex; width:100%;">
                                                       <input type="text" id="dni_Empleado_input" class="form-control" value=""
                                                              placeholder="Ingresar DNI" 
                                                      
                                                              style="font-size:17px; text-align:center;">
                                                       <button id="btn-insertar-marcacion-con-dni" type="submit" class="btn btn-primary"> OK </button><br />

                                                       <!-- MARCADOR DNI -->
                                                       <label style="color:red;" id="int_NumeroDeMarcadorDeTipoDni" hidden>MARCADOR DNI</label>
                                                       <label style="color:red;" id="txt_NumeroDeMarcadorDeTipoDni" hidden>MARCADOR DNI</label>
                                                               @*onkeypress="validarCampoDniTomaConsumos(event)"*@ 
                                                       <br>
                                                   </div>
                                                   <br /><label id="dni_Empleado_input_error" style="color:#F50707;"></label><br />
                                               </div>

            @*<button onclick="maxCarateresDocIdentidad()">MAXCARACT</button>*@
         </center>
    </div>
</div>




<!--==============================================================================
               CONTENEDOR PRINCIPAL PARA TODOS LOS DIVS DE CONSUMO
==================================================================================-->
<div class="row" id="idTemporizador" hidden>
    <div class="alert alert-success" style="display:flex; width: 100%;">
        <div class="col-lg-8 col-md-6 col-sm-3 col-xs-12">
            <h2 style="color: #FFFFFF;" id="titulo"> LA VENTANA DE TOMA DE CONSUMOS SE CERRARÁ EN: </h2>
        </div>
        <div class="col-md-6 col-sm-3 col-xs-12" style="font-size: 35px; color:#F50707;">
            <center>
                <span style="display: inline" id='hours' hidden></span>
                <span style="display: inline" id='h_' hidden> : </span>
                <span style="display: inline" id='minutes' hidden></span>
                <span style="display: inline" id='m_' hidden> : </span>
                <span style="display: inline" id='seconds' hidden></span>
                <button id="btn-refresh" class="btn btn-danger btn-xs" style="width:40px; margin:10px 0 0 35px;" hidden><i class="fa fa-refresh"> + </i></button>
            </center>
        </div>
        <div class="col-md-4 col-sm-3 col-xs-12">
            <button id='start' hidden>start</button>
            <button id='stop' hidden>stop</button>
            <button id='reset' hidden>reset</button>
            <center>
                <button id="btn-salir-toma-consumo-comensal" class="btn btn-dark" style="width:200px; margin:10px 0 0 30px;"><i class="fa fa-sign-out"></i> FINALIZAR </button>
            </center>
        </div>

    </div>
</div>

<div class="row" id="Contenedor_Toma_Consumos" hidden>

    <div id="contenedor_padre_datos_comensal" hidden>
        @*<button id="boton_reestart" >TEMPORIZADOR</button>*@
        <div class="elemento_flex_01">
            <!-- IMAGEN EMPLEADO -->
            &nbsp;&nbsp;&nbsp;
            <div id="contenedor_imagen_empleado"><img id="imgCarga" src="~/DirEmpleadosRuta/descarga(1).jpg" style="width:100%; max-width:220px;border-radius:2%;" /></div>
            <input type="text" id="txt_imagen_empleado" hidden />
            <!-- FIN IMAGEN EMPLEADO -->
            <h2 style="color: #67879c; font-weight:bold;"> MARCADOR:</h2>
            <h1 style="color:#337ab7;">
                <label id="numeroMarcadorDeLaMarcacion" style="color:#337ab7;max-width: 100%;font-size: 40px; font-weight:bold;margin-bottom: 5px;display: inline-block;">
                </label>
            </h1>
            <h1 id="lblcodigo_marcador" style="color:#337ab7;" hidden></h1>
            <!--  -->
        </div>
        <div class="elemento_flex_01" style="width:500px">
            <!--elemento_flex_hora_fec-->
            <h2 style="color: #67879c; font-weight:bold;"> COMENSAL:</h2>
            <label id="lblNombre" style="color:#337ab7;max-width: 100%;font-size: 25px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></label>
            <!--  -->
            <h2 style="color: #67879c; font-weight:bold;"> FOTOCHECK:</h2>
            <label id="lblFotocheck" style="color:#337ab7;max-width: 100%;font-size: 25px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></label>
            <!--  -->
            <h2 style="color: #67879c; font-weight:bold;"> MARCA:</h2>
            <lalel id="txt_dttFecha" style="color:#337ab7;max-width: 100%;font-size: 25px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></lalel>
            <div>
                <label id="txt_dttFechaHora" style="  overflow: hidden;float: left; color:#337ab7;max-width: 100%;font-size: 25px; font-weight:bold;margin-bottom: 5px;display: inline-block; "></label>
            </div>
        </div>
        <div class="elemento_flex_01" style="width:500px">
            <!--elemento_flex_hora_fec-->
            <!-- DESAYUNO, ALMUERZO, CENA -->
            @*<h2 style="color: #67879c; font-weight:bold;"> N° MARCADOR:</h2>
                <h1 style="color:#337ab7;">
                    <label id="numeroMarcadorDeLaMarcacion" style="color:#337ab7;max-width: 100%;font-size: 40px; font-weight:bold;margin-bottom: 5px;display: inline-block;">
                    </label>
                </h1>
                <h1 id="lblcodigo_marcador" style="color:#337ab7;" hidden></h1>*@
            <!--  -->
            <h2 style="color: #67879c; font-weight:bold;">TIPO DE SERVICIO</h2>
            <label id="lblstrTipoServicio" style="color:#337ab7;max-width: 100%;font-size: 25px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></label>
            @*<h1 id="lblstrTipoServicio" style="color:#337ab7;max-width: 100%;font-size: 25px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></h1>*@
            <!--  -->
            <h2 style="color: #67879c; font-weight:bold;">HORARIO DE ATENCIÓN</h2>
            <label id="lblstrHorarioAtencion" style="color:#337ab7;max-width: 100%;font-size: 25px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></label>
            @*<h1 id="lblstrHorarioAtencion" style="color:#337ab7;max-width: 100%;font-size: 25px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></h1>*@
            <!--  -->
            <h2 style="color: #67879c; font-weight:bold;">MÁX. DE SERVICIOS PERMITIDOS:</h2>
            <label id="lblintCantMaxRN" style="color:#337ab7;max-width: 100%;font-size: 30px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></label>
            @*<h1 id="lblintCantMaxRN" style="color:#337ab7;max-width: 100%;font-size: 30px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></h1>*@
            <!--  -->
            <h2 style="color: #67879c; font-weight:bold;">CANT. DE SERVICIOS DISPONIBLES: </h2>
            <label id="lblintCantMaxConsumo" style="color:#337ab7;max-width: 100%;font-size: 30px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></label>
            @*<h1 id="lblintCantMaxConsumo" style="color:#337ab7;max-width: 100%;font-size: 30px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></h1>*@
            <br />
        </div>
        <div class="elemento_flex_01" style="width:450px">
            <!--elemento_flex_02-->
            <div class="x_panel ui-ribbon-container fixed_height_390">
                <div class="ui-ribbon-wrapper">
                    @*<div class="ui-ribbon"> Carrito </div>*@
                    <div class="ui-ribbon"> CONSUMOS </div>
                </div>
                @*<div class="x_title">
                        <h2 style="font:bold"> CONSUMOS </h2>
                        <div class="clearfix"></div>
                    </div>*@
                <div class="x_content">

                    <!--  -->
                    <h2 style="color: #337ab7; font-weight:bold;">
                        <i class="fa fa-cutlery"></i><span class="badge bg-green" id="SplblCantServ"></span>
                        TOTAL SERVICIOS :
                    </h2>
                    <div class="divider"></div>
                    <h1 id="lblTotalServ" style="color:#2A3F54;max-width: 100%;font-size: 35px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></h1>
                    <br />
                    <h1 id="lblCantServ" style="color:#4B5F71;max-width: 100%;font-size: 15px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></h1>
                    <br />
                    <h1 id="lblCantServAnt" style="color:#67879c;max-width: 100%;font-size: 15px; font-weight:bold;margin-bottom: 5px;display: inline-block;" hidden></h1>
                    <div class="divider"></div>
                    <!--  -->
                    <h2 style="color: #337ab7; font-weight:bold;">
                        <i class="fa fa-credit-card"></i><span class="badge bg-blue" id="SplblCantServC"></span>
                        TOTAL COMPLEMENTOS :
                    </h2>
                    <div class="divider"></div>
                    <h1 id="lblTotalServC" style="color:#2A3F54;max-width: 100%;font-size: 35px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></h1>
                    <br />
                    <h1 id="lblCantServC" style="color:#4B5F71;max-width: 100%;font-size: 15px; font-weight:bold;margin-bottom: 5px;display: inline-block;"></h1>
                    <br />
                    <h1 id="lblCantServCAnt" style="color:#67879c;max-width: 100%;font-size: 15px; font-weight:bold;margin-bottom: 5px;display: inline-block;" hidden></h1>
                    @*<div class="divider"></div>*@
                    <!--  -->


                </div>
            </div>
        </div>

        <!-- VALORES NO VISUALIZADOS PERO NECESARIOS PARA REGISTRAR -->
        <div id="div_intIdPersonal" hidden> </div> <!-- NO VISUALIZADO -->
        <div id="div_strFotocheck" hidden> </div> <!-- SI VISUALIZADO -->
        <div id="div_intIdServicio" hidden> </div> <!-- NO VISUALIZADO -->
        <div id="div_dttFechaHora" hidden> </div> <!-- SI VISUALIZADO -->
        <div id="div_intCantidad" hidden> </div> <!-- NO VISUALIZADO -->
        <label id="lbl_NumMarcadorRelacionado" hidden> </label> <!-- SI VISUALIZADO -->
        <div id="div_bitFlConsumido" hidden> </div> <!-- NO VISUALIZADO -->
        <div id="div_strObservacion" hidden> </div> <!-- NO VISUALIZADO -->
        <div id="div_bitFlEliminado " hidden> </div> <!-- NO VISUALIZADO -->
        <div id="div_intIdUsuarReg  " hidden> </div> <!-- NO VISUALIZADO -->
        <div id="div_dttFeRegistro  " hidden> </div> <!-- NO VISUALIZADO -->
        <div id="div_intIdUsuarModif" hidden> </div> <!-- NO VISUALIZADO -->
        <div id="div_dttFeModif     " hidden> </div> <!-- NO VISUALIZADO -->
        <label id="txt_dttFechaHora_completa" hidden> </label> <!-- HORA DE MARCA COMPLETA NO VISUALIZADO pero necesario -->
        <div id="div_intIdConsumo" hidden> </div> <!-------------------------------- ID ULTIMO REGISTRO ----------------->
        <div id="div_intIdAsistencia" hidden> </div> <!-------------------------------- IDASISTENCIA NECESARIO PARA TRAER LOS SERVICIOS ----------------->
        <h1 class="h1_titulos" id="lbl_intIdReglaNeg" hidden></h1> <!--------------- INTEGER REGLA DE NEGOCIO ----------->
        <label id="lblintValida" hidden> </label>
    </div>
</div>

<div class="row">
    <br> <br>
</div>

<!--INI  LISTADOS DE SERVICIOS -->
<div class="row">
    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" id="TbServiciosDiv" hidden>
        <div class="x_panel">
            <div class="form-hide-servicios" hidden="" style="display: block;">

                <div class="x_title">
                    <h2>Servicios Disponibles</h2>
                    <ul class="nav navbar-right panel_toolbox"></ul>
                    <div class="clearfix"></div>
                </div>


                <!--==============================================================================
                    TABLA DE LISTADO GENERAL SERVICIOS/REGLANEGOCIO (para dicha marcación) datatable-reg-neg-serv
                ==================================================================================-->
                <br />
                <div class="x_content" id="contenedor-table-lista-servicios">
                    <!--<div class="x_content" id="contenedor-table-lista-servicios" style=" width : 50% ; top:43%; left:20%;">-->
                    <table id="table-lista-servicios-disponibles" class="table table-striped table-bordered table-responsive nowrap" cellspacing="0" width="100%" hidden>
                        <thead>
                            <tr>
                                <th style="display:none">IntIdReglaNeg</th>
                                <th style="display:none">intIdServicio</th>
                                <th>SERVICIO</th>
                                <th>TIPO SERVICIO</th>
                                <th>TIPO MENÚ</th>
                                <th style="display:none;">COSTO</th><!--style="display:none;"-->
                                <th>PRECIO UNT.</th>
                                <th style="display:none;">TCAMBIO</th> <!--20.03.2021-->
                                <th style="display:none;">SIMBOLO</th> <!--20.03.2021-->
                                <th>ACCIÓN</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <!--==============================================================================-->



            </div>
        </div>
    </div>

    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" id="TbcomplementariosDiv" hidden>
        <div class="x_panel">
            <div class="form-hide-scomplementos" hidden="" style="display: block;">

                <div class="x_title">
                    <h2>Complementos Disponibles</h2>
                    <ul class="nav navbar-right panel_toolbox"></ul>
                    <div class="clearfix"></div>
                </div>



                <!--==============================================================================
                    LISTA DE COMPLEMENTOS
                ==================================================================================-->
                <br />
                <div class="x_content" id="contenedor-table-lista-complementarios">
                    <table id="table-lista-servicios-complementarios" class="table table-striped table-bordered table-responsive nowrap" cellspacing="0" width="100%" hidden>
                        <thead>
                            <tr>
                                <th style="display:none">intIdServicio</th>
                                <th>DESCRIPCIÓN</th>
                                <th>CATEGORÍA</th>
                                <th style="display:none;">COSTO</th>
                                <th>PRECIO UNT.</th>
                                <th style="display:none;">TCAMBIO</th>
                                <th style="display:none;">SIMBOLO</th>
                                <th>ACCIÓN</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <!--==============================================================================-->

            </div>
        </div>
    </div>
</div><!--FIN-->
<!--FIN - AÑADIDO 19.03.2021-->

<div class="row">

    <!--==============================================================================
                   CONTENEDOR DE LOS CARDS (estarán como hidden/oculto)
    ==================================================================================-->
    <!-- CONTENEDOR DE SERVICIOS y TIPO DE MENU (estan trabajados mediante combos) -->
    <div style="margin-top:200px; position: absolute; " hidden>

        <!-- CARD UNO -->
        <div class="grid-5 up">
            <div class="card card-elevation color-pink">
                <div class="">
                    <img class="img" src="https://images.unsplash.com/photo-1455099675745-a442989ac8bf?ixlib=rb-0.3.5&s=e505ede03d79e833ac6df5e29534af44&auto=format&fit=crop&w=1366&q=80 1366w" hidden>


                    <br /><select id="TipMenuTomaConsumo" style="border: none !important;" disabled>
                        <option value="0">TIPO DE MENU</option>
                        <!--TIPO DE MENU(ejecutivo,economico...)-->
                    </select>


                    <br /><center>
                        <label style="font-size:20px; color:#60768c;">S/</label>
                        <label style="font-size:35px; color:#60768c;" id="txt_monCostoServ"></label><br />
                        <button id="btn-seleccionar-insertar-toma-consumo" class="color-pink btn">Seleccionar</button> <br /><br />
                        <div style="font-size:20px; color:#60768c;" id="div_intIdConsumo_2"> </div> <!-- ID ULTIMO REGISTRO -->
                        <div id="div_intIdServicio1" style="color:#3b5067">...</div>
                        <div id="render_data" style="color:#3b5067">...</div>
                    </center>
                </div>
            </div>
        </div>

        <!-- CARD VACIO SIN TIPO DE SERVICIO -->
        <div class="grid-5 up" hidden>
            <div class="card card-elevation color-pink">
                <div class="">
                    <img class="img" src="https://images.unsplash.com/photo-1455099675745-a442989ac8bf?ixlib=rb-0.3.5&s=e505ede03d79e833ac6df5e29534af44&auto=format&fit=crop&w=1366&q=80 1366w">
                    <br /> <br />
                    <center>
                        <label style="font-size:20px; color:#60768c;">S/</label>
                        <label style="font-size:35px; color:#60768c;" id="txt_monCostoServ" hidden></label><br />
                        <button id="" class="color-pink btn">Seleccionar</button> <br /><br />
                        <button id="" class="color-pink btn" hidden>REGISTAR</button>
                    </center>
                </div>
            </div>
        </div>


        <div class="grid-5 up" hidden>
            <div class="card card-elevation color-pink">
                <div class="">
                    <br /> <br />
                    <center>
                        <label style="font-size:20px; color:#60768c;">S/</label>
                        <button id="btn-seleccionar-insertar-toma-consumo2" class="color-pink btn">Seleccionar</button> <br /><br />
                    </center>
                </div>
            </div>
        </div>

    </div>
</div>



<!--========================= INICIO WEBSOCKET SIGNALR =========================-->

@Html.Hidden("GetAsistenciaTomaConsumo", Url.Action("GetAsistenciaTomaConsumo", "Personal"))
<!------------------------------------------>
<!----ESTA LINEA DE CODIGO NO ES VISIBLE PERO ES NECESARIO------>
<script src="~/Scripts/jquery.signalR-2.4.1.min.js"></script>
<script src="~/signalr/hubs" type="text/javascript"></script> <!-- Este js es autogenerado solo durante la ejecucion del sistema -->
<!-- Script Para el Mantenimiento Toma Consumo y el Web Sockets -->
<script>
    mi_variable_global_ = 0;
</script>
<script src="~/Scripts/web-socket-toma-consumo.js"></script>
<!--======================== FIN WEBSOCKET SIGNALR ===========================-->
<!--===========================================================================================
    SCRIPT PARA EL TIEMPO DINAMICO, EN HORAS, FORMATO 24hrs, No usa la libreria moment.min.js
===============================================================================================-->
<script type="text/javascript">
    $(document).ready(function () {
        fechaHoraTomaConsumo();
    });
</script>


<!-- HOJA DE ESTILOS SOLO PARA ESTE MANTENIMIENTO: TOMA DE CONSUMO -->
<link href="~/Content/consumos/consumos_stilos.css" rel="stylesheet" />

<!-- FUNCION PARA CONTADOR DE TIEMPO -->
<style>
    p {
        text-align: center;
        font-size: 25px;
    }

    #timer {
        font-size: 40px;
        font-family: Arial, sans-serif;
        font-weight: bold;
    }

    /*Quitar borde de combos*/
    .borde_combo {
        background-color: #111111;
        border: 1px solid #00C4FF; /* ESTA ES LA PROPIEDAD */
        cursor: pointer;
        font-family: Verdana,Verdana,Verdana,Verdana;
        font-weight: 400;
        padding: 1px;
        vertical-align: middle;
    }

    #TipServicioTomaConsumo, #tiempo {
        margin-left: 60px;
        padding: 2px 30px 2px 2px;
        background: transparent;
        font-size: 45px;
    }

    #TipServicioTomaConsumo2 {
        margin-left: 60px;
        padding: 2px 30px 2px 2px;
        background: transparent;
        font-size: 45px;
    }

    #TipMenuTomaConsumo {
        margin-left: 32px;
        width: 400px;
        -webkit-appearance: none;
        -moz-appearance: none;
        padding: 2px 30px 2px 2px;
        background: transparent;
        font-size: 45px;
    }

    #TipServicioTomaConsumo_Horario {
        text-transform: uppercase;
        color: white;
        width: 400px;
        -webkit-appearance: none;
        -moz-appearance: none;
        padding: 0px 30px 2px 2px;
        background: transparent;
        font-size: 45px;
        margin: 0px 0 0 30%;
    }

    #TipServicioTomaConsumo_Horario_Titulo {
        text-transform: uppercase;
        -webkit-appearance: none;
        -moz-appearance: none;
        background: transparent;
        font-size: 45px;
    }

    #TipServicioTomaConsumo_Horario_h1 {
    }

    .label_titulos, .h1_titulos {
        color: white;
    }
</style>
<style>
    #Contenedor_Toma_Consumos {
        width: 100%;
    }

    #contenedor_tipo_serv {
        flex-direction: column;
        width: 20%;
    }

    #contenedor_padre_datos_comensal {
        background-color: #FFFFFF; /*Color de fondo: #2a3f54 */
        display: flex;
        max-width: 100%;
    }

    .elemento_flex_01 {
        margin: 20px;
        max-width: 70%;
    }

    .elemento_flex_02 {
        margin: auto; /*centrado*/
        display: flex;
        flex-direction: column;
        /*left:-20px;*/
    }


    .elemento_flex_hora_fec {
        color: white;
        font-size: 30px;
        display: flex;
        flex-direction: column;
        margin: auto; /*centrado*/
    }
</style>
<style>
    /*body {
        font-family: Arial, Helvetica, sans-serif;
    }*/

    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1100; /* Sit on top */
        padding-top: 200px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        /*width: 30%; //comentado 06.05.2021*/
    }

    /* The Close Button */
    .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
</style>

<script>

    //===============================================================================================
    //================================ MUTATION OBSERVER (para websocket) ===========================
    //===============================================================================================
    //http://jsfiddle.net/6Jajs/1/
    var target = document.querySelector('#input_idAsistencia'); //comentado 14.04.2021 HG
    console.log('el codigo target observado es: ' + target);
    var observer = new WebKitMutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
            console.log("Este es un Success para la variable observer del WebKitMutationObserver_fx");
        });
    });
    observer.observe(target, { attributes: true, childList: true, characterData: true, subtree: true });

    let ArrayValoresMarca = [{ idMarca: "0" }];//añadido 14.04.2021 "0"
    console.log("ArrayValoresMarca")
    console.log(ArrayValoresMarca);

    //inicio comentado
    setInterval(function () {
       //var isEmpty = $("#lblIdAsistencia").html() === ""; //comentado 14.04.2021 HG
       var isEmpty = $("#input_idAsistencia").val();
        console.log("==========================================");
        console.log("isEmpty :");
        console.log(isEmpty);
        console.log("==========================================");

        function marcaExists(idMarca) {
            return ArrayValoresMarca.some(function (ele) {
                return ele.idMarca === idMarca;
            });
        }

        marcaExists = marcaExists(isEmpty); //devuelve true o false
        if (marcaExists == false) {
            //alert("Valor not existe!");
            ArrayValoresMarca.push({ idMarca: isEmpty });
            console.log("ArrayValoresMarca")
            console.log(ArrayValoresMarca);
            boton_trigger_visor();
            $('#Contenedor_Toma_Consumos').show();
            $('#table-lista-servicios-disponibles').hide();
            $('#titulo-table-lista-servicios-disponibles').hide();
        }
        else {
            //alert("Valor ya Existe Detenerse!")
            //Si ya el idAsistencia paso por aqui entonces si vuelve a pasar no hagas nada
        }
        //if (!isEmpty) {
        //    boton_trigger_visor();
        //    //$('#lblIdAsistencia').empty(); //comentado 14.04.2021 HG
        //    $('#Contenedor_Toma_Consumos').show();
        //    $('#table-lista-servicios-disponibles').hide();
        //    $('#titulo-table-lista-servicios-disponibles').hide();
        //}
    }, 2000);//Este también valor fue aumentado, originalmente 500 - HG 13.04.2021


    //===============================================================================================46920
    //=================================== FUNCION countdown, tiempo de espera, timer ================countdown
    //===============================================================================================
    var tiempo_cierre = $('#tiempo_cierre_consumo_web_config').text();
    var tiempo_cierre_after = $('#tiempo_cierre_consumo_after').text();

    (function () {
        "use strict";
        var
            secondsLabel = document.getElementById('seconds')
            , minutesLabel = document.getElementById('minutes')
            , hoursLabel = document.getElementById('hours')
            , totalSeconds = (0 - tiempo_cierre)
            , startButton = document.getElementById('start')
            , stopButton = document.getElementById('stop')
            , resetButton = document.getElementById('reset')
            , timer = null;

        startButton.onclick = function () {
            if (!timer) {
                timer = setInterval(setTime, 1000);
            }
        };

        stopButton.onclick = function () {
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
        };

        resetButton.onclick = function () {
            if (timer) {
                totalSeconds = (0 - tiempo_cierre_after)
                stop();
            }
        };

        function setTime() {
            totalSeconds++;
            var totalSecondsPos = Math.abs(totalSeconds);

            if (totalSecondsPos >= 3600) {
                hoursLabel.innerHTML = pad(parseInt(totalSecondsPos / 3600));
                minutesLabel.innerHTML = pad(parseInt((totalSecondsPos - (parseInt(totalSecondsPos / 3600) * 3600)) / 60));
                secondsLabel.innerHTML = pad((totalSecondsPos - (parseInt(totalSecondsPos / 3600) * 3600)) % 60);
            } else if (totalSecondsPos >= 60) {
                hoursLabel.innerHTML = pad(0);
                minutesLabel.innerHTML = pad(parseInt(totalSecondsPos / 60));
                secondsLabel.innerHTML = pad(totalSecondsPos % 60);

            } else {
                hoursLabel.innerHTML = pad(0);
                minutesLabel.innerHTML = pad(0);
                secondsLabel.innerHTML = pad(totalSecondsPos);
            }

            var segundos_ = $('#seconds').text();
            var minutos_ = $('#minutes').text();
            var horas_ = $('#hours').text();
            var tiempo_total = ((segundos_ - 1) + (minutos_ * 60) + (horas_ * 3600))

            console.log(totalSeconds);
            if ($('#seconds').text() == '00' && $('#minutes').text() == '00') {
                stopButton.click();
                $('#seconds').empty();
                $('#seconds').append('00');

                swal({
                    title: "Finalizar Toma de Consumo",
                    text: "El tiempo de atención para el registro de sus consumos ha terminado.",//"¿Desea Seleccionar un Servicio?",
                    type: "warning",
                    showCancelButton: true,
                    cancelButtonText: "Continuar",
                    confirmButtonText: "Finalizar",//"Abandonar",
                    allowOutsideClick: false, //añadido 25/03/2021
                    closeOnClickOutside: false,//añadido 25/03/2021
                    closeOnEsc: false,//añadido 25/03/2021
                }).then(function (isConfirm) {
                    if (isConfirm) {
                        swal({
                            title: "SISFOOD",
                            text: "Gracias por utilizar nuestro servicio",
                            timer: 2500,
                        }).then(function (isConfirm) { }
                            , function (dismiss) {
                                if (dismiss === 'cancel') { // you might also handle 'close' or 'timer' if you used those
                                    // ignore
                                } else if (dismiss === 'timer') { // you might also handle 'close' or 'timer' if you used those
                                    // ignore
                                } else {
                                    throw dismiss;
                                }
                            }
                            //
                        );

                        $('#contenedor_superior_top_nav').fadeIn('slow').delay(2000).show();
                        $('#pantalla_bienvenida_modo_espera').fadeIn('slow').delay(3000).show();
                        $('#contenedor_padre_datos_comensal').fadeOut('slow').delay(3000).hide();
                        $('#table-lista-servicios-disponibles').hide();
                        $('#idTemporizador').hide();
                        $('#TbServiciosDiv').hide();
                        $('#TbcomplementariosDiv').hide();
                        $('#contenedor-table-lista-complementarios').hide();
                        $('#contenedor-table-lista-servicios').hide();
                        $('#table-lista-servicios-disponibles').hide();
                        $('#table-lista-servicios-complementarios').hide();

                        //$('#titulo-table-lista-servicios-disponibles').hide();
                        stopButton.click();

                        Selec = [];//nueva instancia
                        SelecSC = [];//nueva instancia
                        CantTotalSC = 0;
                        TotalSC = 0;
                        CantTotalS = 0;
                        TotalS = 0;
                    }
                }
                    , function (dismiss) {
                        if (dismiss === 'cancel') { // you might also handle 'close' or 'timer' if you used those
                            // ignore

                            startButton.click();
                            resetButton.click();
                        } else if (dismiss === 'timer') {
                            // ignore
                        } else {
                            throw dismiss;
                        }
                    }
                );
            }
        }

        function pad(val) {
            var valString = val + "";
            if (valString.length < 2) {
                return "0" + valString;
            }
            else {
                return valString;
            }
        }

    })();

    //VALIDAR INPUT DNI, usado como: onkeypress="validarCampoDniTomaConsumos(event)"
    function validarCampoDniTomaConsumos(evt) {

        var theEvent = evt || window.event;

        // Handle paste
        if (theEvent.type === 'paste') {
            key = event.clipboardData.getData('text/plain');
        } else {
            // Handle key press
            var key = theEvent.keyCode || theEvent.which;
            key = String.fromCharCode(key);
        }
        var regex = /[0-9]/;
        if (!regex.test(key)) {
            theEvent.returnValue = false;
            if (theEvent.preventDefault) theEvent.preventDefault();
        }
    }

</script>



